<!DOCTYPE html>
<html>
<head>

  <meta charset="UTF-8">
  <title>Blogging with Vagrant.Docker.Jekyll.Github-Pages</title>
  <meta name="viewport" content="width=device-width">

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="/assets/css/style.css" rel="stylesheet" />
  <link href="/assets/css/colors-light.css" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico?">
  <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16" />

</head>

<body>



  <header id="header">
  <!-- <h1><a href="/"><i class="icon-sun"></i> Existential Techie</a></h1> -->
  <h1><i class="icon-sun"></i> Existential Techie</h1>
  <a href="/dark/vagrant/docker/github/jekyll/blogging/2016/03/03/Blogging-with-Vagrant-Docker-Jekyll-Github">Join the dark side!</a>
    <p>Linux, Containers ( Docker ), Orchestration ( Kubernetes ), DevOps (.*) -- Oh My!   And other wanderings and ramblings.
</p>
  </header>



  <div id="page">



    <div id="sidebar">
      <nav>
        <ul>
          <li><a href="/light/">Home</a></li>
          <li><a href="/archives/light">Archive</a></li>
          <li><a href="/light/about">About</a></li>
	  <li><a href="http://twitter.com/cognitiaclaeves">Twitter</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
        </ul>
      </nav>
    </div>



    <div id="content">
      <article class="post">

	
		<h1><a href="/light/vagrant/docker/github/jekyll/blogging/2016/03/03/Blogging-with-Vagrant-Docker-Jekyll-Github/">Blogging with Vagrant.Docker.Jekyll.Github-Pages</a></h1>
	

	<div class="post-content"><p>Here is how I set up my blog. ( This post will be a little involved.)  Also, this post is currently in progress; there will be clean-up later.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">~/personal
➔ mkdir phusion-jekyll<span class="p">;</span> <span class="nb">cd </span>phusion-jekyll

~/personal/phusion-jekyll
➔ git clone https://github.com/phusion/baseimage-docker.git
Cloning into <span class="s1">&#39;baseimage-docker&#39;</span>...
remote: Counting objects: 1193, <span class="k">done</span>.
remote: Total <span class="m">1193</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 1193
Receiving objects: 100% <span class="o">(</span>1193/1193<span class="o">)</span>, 1.48 MiB <span class="p">|</span> 1.57 MiB/s, <span class="k">done</span>.
Resolving deltas: 100% <span class="o">(</span>699/699<span class="o">)</span>, <span class="k">done</span>.
Checking connectivity... <span class="k">done</span>.

~/personal/phusion-jekyll
➔ <span class="nb">cd </span>baseimage-docker

personal/phusion-jekyll/baseimage-docker on master
➔ ls
CONTRIBUTING.md Makefile README_zh_tw.md install-tools.sh
Changelog.md README.md Vagrantfile <span class="nb">test</span>
LICENSE.txt README_ZH_cn_.md image tools

personal/phusion-jekyll/baseimage-docker on master
➔ vagrant up</code></pre></div>

<p>I want a folder in the VM to directly reference my work folder (future github) folder, so I add this line:</p>

<p><code>config.vm.synced_folder "data", "/home/vagrant/data"</code></p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">➔ tail -6 Vagrantfile
    config.vm.provision :shell, :inline <span class="o">=</span>&gt; <span class="nv">$script</span>
  end

  config.vm.synced_folder <span class="s2">&quot;data&quot;</span>, <span class="s2">&quot;/home/vagrant/data&quot;</span>

end</code></pre></div>

<p>Then I create the data folder and restart the vagrant box:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">personal/phusion-jekyll/baseimage-docker on master <span class="o">[</span>!<span class="o">]</span>
➔ mkdir data<span class="p">;</span> vagrant halt<span class="p">;</span> vagrant <span class="nv">up</span>

<span class="o">==</span>&gt; default: Attempting graceful shutdown of VM...

Bringing machine <span class="s1">&#39;default&#39;</span> up with <span class="s1">&#39;virtualbox&#39;</span> provider...
...</code></pre></div>

<p>My new folder is at the top of this list:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">==</span>&gt; default: Mounting shared folders...
default: /home/vagrant/data <span class="o">=</span>&gt; /Users/jnorment/personal/phusion-jekyll/baseimage-docker/data
default: /vagrant/baseimage-docker <span class="o">=</span>&gt; /Users/jnorment/personal/phusion-jekyll/baseimage-docker
default: /vagrant <span class="o">=</span>&gt; /Users/jnorment/personal/phusion-jekyll/baseimage-docker</code></pre></div>

<p>Next, I run the following in the vagrant session, to build the initial files:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd </span>data
docker run <span class="se">\</span>
  --interactive <span class="se">\</span>
  --label<span class="o">=</span>jekyll <span class="se">\</span>
  --publish 4000:4000 <span class="se">\</span>
  --rm <span class="se">\ </span>
  --tty <span class="se">\</span>
  --volume<span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/srv/jekyll 
  jekyll/jekyll:pages jekyll new . --force</code></pre></div>

<p>( TODO: Docker warning here? )</p>

<p>( TODO: Screen-shot )</p>

<p>( TODO: What a clean install looks like )</p>

<p>.. and create this file (phusion-jekyll/baseimage-docker/exec-jekyll.sh), to run the jekyll container:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /home/vagrant/data
docker stop jekyll_runtime 2&gt; /dev/null
docker rm -v jekyll_runtime 2&gt; /dev/null
docker run <span class="se">\</span>
    --env <span class="nv">FORCE_POLLING</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    --env <span class="nv">JEKYLL_ENV</span><span class="o">=</span>development <span class="se">\</span>
    --env <span class="nv">VERBOSE</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    --label<span class="o">=</span>jekyll <span class="se">\</span>
    --name<span class="o">=</span>jekyll_runtime <span class="se">\</span>
    --publish <span class="s2">&quot;0.0.0.0:4000:80&quot;</span> <span class="se">\</span>
    --rm <span class="se">\</span>
    --volume<span class="o">=</span><span class="s2">&quot;$(pwd):/srv/jekyll&quot;</span> <span class="se">\</span>
    jekyll/jekyll:pages jekyll build --watch</code></pre></div>

<p>… and make the file executable:</p>

<p><code>chmod +x exec-jekyll.sh</code></p>

<p>To make the webserver in the container accessible, and to execute my new script, I add these lines to the Vagrantfile that I edited before:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">...

  config.vm.synced_folder <span class="s2">&quot;data&quot;</span>, <span class="s2">&quot;/home/vagrant/data&quot;</span>
  config.vm.network :forwarded_port, guest: 4000, host: 4000
  config.vm.provision <span class="s2">&quot;shell&quot;</span>, path: <span class="s2">&quot;exec-jekyll.sh&quot;</span>
end</code></pre></div>

<p><code>vagrant provision</code> runs the script:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">personal/phusion-jekyll/baseimage-docker on master <span class="o">[</span>!<span class="o">]</span>
➔ vagrant <span class="nv">provision</span>
<span class="o">==</span>&gt; default: Running provisioner: shell...
        default: Running: /var/folders/9s/320v29913qs9j6kzxnqv7smclw01rh/T/vagrant-shell201
60302-97040-1s32frt.sh
<span class="o">==</span>&gt; default: stdin: is not a <span class="nv">tty</span>
<span class="o">==</span>&gt; default: <span class="nv">jekyll_runtime</span>
<span class="o">==</span>&gt; default: Github does not allow user dependencies.
<span class="o">==</span>&gt; default: Configuration file: /srv/jekyll/_config.yml
<span class="o">==</span>&gt; default: Source: /srv/jekyll
<span class="o">==</span>&gt; default: Destination: /srv/jekyll/_site
<span class="o">==</span>&gt; default: Generating...
<span class="o">==</span>&gt; default: <span class="k">done</span>.
<span class="o">==</span>&gt; default: Auto-regeneration: enabled <span class="k">for</span> <span class="s1">&#39;/srv/jekyll&#39;</span></code></pre></div>

<p>Now, I can browse to: http://localhost:4000, and click on the “Welcome to Jekyll” link.</p>

<p>This link was generated from data/_posts/[date]-welcome-to-jekyll.markdown</p>

<p>I switch to another terminal and edit the file locally:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">post</span>
<span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Welcome</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Jekyll!&quot;</span>
<span class="l-Scalar-Plain">date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">...</span> 
<span class="l-Scalar-Plain">categories</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jekyll update</span>
<span class="nn">---</span>
<span class="l-Scalar-Plain">You’ll find this post in your `_posts` directory. ...</span></code></pre></div>

<p>I change the above to:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">post</span>
<span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Welcome</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Jekyll!&quot;</span>
<span class="l-Scalar-Plain">date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">...</span> 
<span class="l-Scalar-Plain">categories</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jekyll update</span>
<span class="nn">---</span>
<span class="l-Scalar-Plain">You’ll find this SAMPLE post in your `_posts` directory. ...</span></code></pre></div>

<p>and when I save the file, I see activity in the previous terminal session:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">...
<span class="o">==</span>&gt; default: <span class="k">done</span>.
<span class="o">==</span>&gt; default: Auto-regeneration: enabled <span class="k">for</span> <span class="s1">&#39;/srv/jekyll&#39;</span>
<span class="o">==</span>&gt; default: Regenerating: <span class="m">1</span> file<span class="o">(</span>s<span class="o">)</span> changed at 2016-03-02 23:47:21</code></pre></div>

<p>Finally, when I refresh the localhost:4000, it’s updated!</p>

<p>( TODO: Image here )</p>

<p>When I’m finished updating my site, I take the vagrant box down:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">==</span>&gt; default:       Regenerating: <span class="m">1</span> file<span class="o">(</span>s<span class="o">)</span> changed at 2016-03-03 15:00:13
<span class="o">==</span>&gt; default: ...done in 0.860794742 seconds.
^C<span class="o">==</span>&gt; default: Waiting <span class="k">for</span> cleanup before exiting...
^C<span class="o">==</span>&gt; default: Exiting immediately, without cleanup!

personal/phusion-jekyll/baseimage-docker on master <span class="o">[</span>!?<span class="o">]</span>
➔ vagrant <span class="nv">halt</span>
<span class="o">==</span>&gt; default: Attempting graceful shutdown of VM...

personal/phusion-jekyll/baseimage-docker on master <span class="o">[</span>!?<span class="o">]</span></code></pre></div>

<p>In this way, I take advantage of containers to run a Jekyll process that converts markdown files to a static web site, which I can see from your localhost’s ( workstation ) browser. Then, when everything looks exactly as I want it, I publish the site on github pages.</p>

<p>I actually do a little more work to get the switchable theme in my static website. This work amounts to mangling the generated files with the use of a bash and a python script.</p>

<p>For the next blog in this series, I’ll post how to easily work github pages into this, and then my steps to create a new blog entry, after all the setup is done.</p>
</div>

	<p class="meta">Posted on <span class="postdate">Mar 03, 2016</span></p>

</article>

    </div>

    

  <!-- Add Disqus comments. -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'existentialtechie'; // required: replace example with your forum shortname
    var disqus_identifier = "data-disqus-identifier/light/vagrant/docker/github/jekyll/blogging/2016/03/03/Blogging-with-Vagrant-Docker-Jekyll-Github/";
    var disqus_developer = 1; // Comment out when the site is live

    /* disqusid: data-disqus-identifier */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



  </div>


    <footer id="footer">
  <p class="copyright">Copyright &copy; 2016 Existential Techie. 
      <br />Powered by <a href="http://jekyllrb.com">Jekyll</a>, 
      <a href="http://ethanschoonover.com/solarized#features"> Solarized </a>
      theme by <a href="http://www.webmaster-source.com">Matt Harzewski</a>
  </p>
  </footer>



  <!--
  <footer id="footer">
  <p class="copyright">Copyright &copy; 2016 Existential Techie. 
      <br />Powered by <a href="http://jekyllrb.com">Jekyll</a>, 
      <a href="http://ethanschoonover.com/solarized#features"> solarized </a>
      theme by <a href="http://www.webmaster-source.com">Matt Harzewski</a>
  </p>
  </footer>
  -->


  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src="/assets/js/jquery.mobilemenu.min.js"></script>

  <script>
    $(document).ready(function(){
      $('#sidebar nav ul').mobileMenu({'topOptionText': 'Menu', 'prependTo': '#sidebar nav'});
    });
  </script>


</body>
</html>
